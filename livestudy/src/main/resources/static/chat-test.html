<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat Test Page</title>
    <script src="/js/jquery-3.5.1.slim.min.js"></script>
    <script src="/js/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
    <h2>íšŒì›ê°€ì…</h2>
    <label for="signup-email"></label><input id="signup-email" placeholder="ì´ë©”ì¼" />
    <label for="signup-password"></label><input id="signup-password" placeholder="ë¹„ë°€ë²ˆí˜¸" type="password" />
    <label for="signup-nickname"></label><input id="signup-nickname" placeholder="ë‹‰ë„¤ì„" />
    <label for="signup-intro"></label><input id="signup-intro" placeholder="ìê¸°ì†Œê°œ" />
    <button onclick="signup()">íšŒì›ê°€ì…</button>

    <h2>ë¡œê·¸ì¸</h2>
    <label for="login-email"></label><input id="login-email" placeholder="ì´ë©”ì¼" />
    <label for="login-password"></label><input id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸" type="password" />
    <button onclick="login()">ë¡œê·¸ì¸</button>

    <h2>WebSocket Chat Test</h2>
    <label for="msg"></label>
    <input id="msg" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!" />
    <button onclick="sendMessage()">ì „ì†¡</button>
    <ul id="messages"></ul>

    <script>
        function connectWebSocket(token) {
            const socket = new SockJS("/ws");
            stompClient = Stomp.over(socket);

            stompClient.connect(
                { Authorization: "Bearer " + token },
                function (frame) {
                    console.log("âœ… STOMP ì—°ê²° ì„±ê³µ:", frame);

                    // âœ” êµ¬ë…í•  topic ë³€ê²½
                    stompClient.subscribe("/topic/chat.room.test-room", function (msg) {
                        const chat = JSON.parse(msg.body);
                        const li = document.createElement("li");
                        li.innerText = `ğŸ“¨ ${chat.sender}: ${chat.content}`;
                        document.getElementById("messages").appendChild(li);
                    });
                },
                function (error) {
                    console.error("âŒ STOMP ì—°ê²° ì‹¤íŒ¨:", error);
                }
            );
        }

        function sendMessage() {
            if (!stompClient || !stompClient.connected) {
                alert("WebSocketì— ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.");
                return;
            }

            const msg = document.getElementById("msg").value;

            const chatMessage = {
                roomId: "test-room",   // ë°© ID (ê³ ì •ê°’ì´ë“  ë™ì ì´ë“  ê°€ëŠ¥)
                content: msg
            };

            stompClient.send("/pub/chat.send", {}, JSON.stringify(chatMessage));
            document.getElementById("msg").value = "";
        }

    </script>
</body>
</html>